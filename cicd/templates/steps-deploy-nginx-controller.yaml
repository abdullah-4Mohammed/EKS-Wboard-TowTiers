
steps:
  # Install Helm
  - task: HelmInstaller@0
    displayName: 'Install Helm'
    inputs:
      helmVersion: '3.x'

  - script: |
      helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
      helm repo update
      helm upgrade ingress-nginx ingress-nginx/ingress-nginx --create-namespace -n ingress-nginx --install --set controller.service.externalTrafficPolicy=Local
    displayName: 'Deploy NGINX Ingress Controller'

  - script: |
      set -x
      kubectl apply -f $(System.DefaultWorkingDirectory)/deploy/ingress/dev-frontend-ingress.yaml
    displayName: 'Apply Ingress deployment'
